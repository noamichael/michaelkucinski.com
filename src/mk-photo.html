<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="./mk-photo-viewer-behavior.html">
<link rel="import" href="shared-styles.html">


<dom-module id="mk-photo">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }
        </style>
        <iron-ajax id="flickrRequest" loading="{{loading}}" on-response="handleFlickrResponse" url="https://api.flickr.com/services/rest"
            params="{{findSinlgePhotoParams(photoId)}}" handle-as="json" debounce-duration="300">
        </iron-ajax>
        <paper-button raised on-tap="goBack">
            <iron-icon icon="arrow-back"></iron-icon>Back
        </paper-button>
        <h2>[[photo.title._content]]</h2>
        <img id="viewer">
        <div class="buttons">
            <paper-button dialog-dismiss raised>Cancel</paper-button>
            <paper-button dialog-confirm raised autofocus>Accept</paper-button>
        </div>
    </template>

    <script>
    Polymer({
      is: 'mk-photo',
      behaviors: [PhotoViewerBehavior],
      properties: {
          photoId: {
              type: String,
              observer: '_photoChanged'
          }
      },
      _getImageUrl(){
          return this.photo ? this.getImageUrl(this.photo, 'z') : '';
      },
      goBack(){
          this._photoChanged();
          this.fire('back');
      },
      handleFlickrResponse: function(event){
          this.photo = event.detail.response.photo;
          this.$.viewer.src = this._getImageUrl();

      },
      _photoChanged: function(){
          this.photo = undefined;
          this.$.viewer.src = '';
          this.$.flickrRequest.generateRequest();
      }
    });
  </script>
</dom-module>