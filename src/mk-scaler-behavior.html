<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-down-animation.html">

<script>
    function ScalerElement(SuperClass) {
        return class extends SuperClass {
            static get properties() {
                return {
                    visible: {
                        type: Boolean,
                        notify: true,
                        observer: '_visibleChange'
                    }
                };
            }
            _visibleChange(visible) {
                if (visible) {
                    this._show();
                } else {
                    this._hide();
                }
            }
            _show() {
                this.style.display = 'block';
                this.__animate(this, [
                    { 'transform': 'scale(1, 0)' },
                    { 'transform': 'scale(1, 1)' }
                ]).then(() => {
                    this._afterAnimation(this.visible);
                });
            }
            _hide() {
                this.__animate(this, [
                    { 'transform': 'scale(1, 1)' },
                    { 'transform': 'scale(1, 0)' }
                ]).then(() => {
                    this.style.display = 'none';
                    this._afterAnimation(this.visible);
                });
            }
            _onAnimationFinish() {
                if (this.visible) {
                    this.style.display = 'block';
                } else {
                    this.style.display = 'none';
                }
                this._afterAnimation(this.visible);
            }
            _afterAnimation(visible) {
                //overridden
            }
            __animate(node, keyframes) {
                if (this._lastAnimation) {
                    this._lastAnimation.cancel();
                }
                node.style.transformOrigin = '0 50%';
                return new Promise(resolve => {
                    const animation = node.animate(
                        keyframes,
                        {
                            duration: 500,
                            easing: 'cubic-bezier(0.4, 0, 0.2, 1)',
                            fill: 'both'
                        });
                    animation.onfinish = (e) => {
                        resolve(e);
                    };
                    this._lastAnimation = animation;
                });
            }
        }
    }

</script>